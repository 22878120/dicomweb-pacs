(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{770:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(1),o=n.n(i),s=n(7),c=n.n(s),l=n(9),u=n.n(l),m=n(767),d=n.n(m),f=n(75),p=n(16),v=n(8),I=n(89),g=n(6),b=n.n(g),h=function(e){var t=e.imageId,n=e.scale,a=e.windowWidth,i=e.windowCenter,o=e.imageIndex,s=e.stackSize,l=e.activeTools,u="absolute pointer-events-none",m=l.includes("Zoom"),d=l.includes("Wwwc");if(!t)return null;var f=(c.a.metaData.get("generalImageModule",t)||{}).instanceNumber;return r.a.createElement("div",{className:"text-primary-light"},r.a.createElement("div",{className:b()(u,"top-viewport left-viewport")},m&&r.a.createElement("div",{className:"flex flex-row"},r.a.createElement("span",{className:"mr-1"},"Zoom:"),r.a.createElement("span",{className:"font-thin"},n.toFixed(2),"x")),d&&r.a.createElement("div",{className:"flex flex-row"},r.a.createElement("span",{className:"mr-1"},"W:"),r.a.createElement("span",{className:"ml-1 mr-2 font-thin"},a.toFixed(0)),r.a.createElement("span",{className:"mr-1"},"L:"),r.a.createElement("span",{className:"ml-1 font-thin"},i.toFixed(0)))),r.a.createElement("div",{className:b()(u,"top-viewport right-viewport-scrollbar")},s>1&&r.a.createElement("div",{className:"flex flex-row"},r.a.createElement("span",{className:"mr-1"},"I:"),r.a.createElement("span",{className:"font-thin"},"".concat(f," ").concat(o,"/").concat(s)))),r.a.createElement("div",{className:b()(u,"bottom-viewport right-viewport-scrollbar")}),r.a.createElement("div",{className:b()(u,"bottom-viewport left-viewport")}))};h.propTypes={scale:o.a.number.isRequired,windowWidth:o.a.number.isRequired,windowCenter:o.a.number.isRequired,imageId:o.a.string.isRequired,imageIndex:o.a.number.isRequired,stackSize:o.a.number.isRequired,activeTools:o.a.arrayOf(o.a.string)},h.defaultProps={activeTools:[]};var y=h,w=function(e){var t=e.error;return t?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"bg-black h-full w-full absolute opacity-50"}),r.a.createElement("div",{className:"text-primary-light text-xl font-thin"},r.a.createElement("h4",null,"Error Loading Image"),r.a.createElement("p",null,"An error has occurred."),r.a.createElement("p",null,t.message))):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"bg-black h-full w-full absolute opacity-50"}),r.a.createElement("div",{className:"absolute transparent w-full h-full flex items-center justify-center"},r.a.createElement("p",{className:"text-primary-light text-xl font-thin"},"Loading...")))};w.propTypes={percentComplete:o.a.number,error:o.a.object},w.defaultProps={percentComplete:0,error:null};var S=w;function x(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function E(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){x(i,a,r,o,s,"next",e)}function s(e){x(i,a,r,o,s,"throw",e)}o(void 0)}))}}function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var k=f.a.formatDate,U=u.a.ArrowAnnotateTool,j=u.a.BidirectionalTool,P=u.a.EllipticalRoiTool,A=u.a.LengthTool,T=u.a.importInternal("base/BaseAnnotationTool"),C=p.a.utils.StackManager;function R(e){var t=e.children,n=e.dataSource,i=e.displaySet,o=e.viewportIndex,s=e.servicesManager,l=s.services,m=l.ToolBarService,f=l.DisplaySetService,g=N(Object(I.b)(),1)[0],b=N(Object(v.hb)(),2),h=b[0],w=h.activeViewportIndex,x=h.viewports,E=b[1],O=N(Object(v.gb)(),2),R=O[0],F=(O[1],N(Object(a.useState)(null),2)),L=F[0],z=F[1],B=N(Object(a.useState)(null),2),V=B[0],W=B[1],J=N(Object(a.useState)(!1),2),Z=J[0],G=J[1],H=N(Object(a.useState)(null),2),Y=H[0],$=H[1];Object(a.useEffect)((function(){return function(){C.clearStacks()}}),[]),Object(a.useEffect)((function(){V&&(u.a.store.state.tools.filter((function(e){return e.element===V})).forEach((function(e){if(e instanceof U||e instanceof j||e instanceof P||e instanceof A){var t=e.configuration;t.renderDashed=!Z,e.configuration=t}})),c.a.getEnabledElement(V).image&&c.a.updateImage(V))}),[Z]);Object(a.useEffect)((function(){var e=i.StudyInstanceUID,t=i.displaySetInstanceUID,a=i.sopClassUids;if(e&&t){a&&a.length>1&&console.warn("More than one SOPClassUID in the same series is not yet supported.");var r=x[o].imageIndex;i.imageIndex=r,function(e,t){return q.apply(this,arguments)}(n,i).then(z)}}),[n,i,x,o]);var K=null;if(!L)return null;var Q=L.stack,X=Q.imageIds,_=Q.currentImageIdIndex;t&&t.length&&(K=t.map((function(e,t){return e&&r.a.cloneElement(e,{viewportIndex:o,key:t})})));var ee=x.findIndex((function(e){return e.displaySetInstanceUID===i.displaySetInstanceUID})),te=g.context.trackedSeries,ne=i.Modality,ae=i.SeriesDate,re=i.SeriesDescription,ie=i.SeriesInstanceUID,oe=i.SeriesNumber,se=i.images[0],ce=se.PatientID,le=se.PatientName,ue=se.PatientSex,me=se.PatientAge,de=se.SliceThickness,fe=se.PixelSpacing,pe=se.ManufacturerModelName;te.includes(ie)!==Z&&G(!Z);var ve=x.length>1?M[ee]:"";var Ie=Z&&o===w;return r.a.createElement(r.a.Fragment,null,r.a.createElement(v.Y,{onDoubleClick:function(e){e.stopPropagation(),e.preventDefault()},onSeriesChange:function(e){return function(e){if(V){var t=function(e,t,n,a){var r=t.services.MeasurementService.getMeasurements(),i=a.context.trackedSeries,o=r.filter((function(e){return i.includes(e.referenceSeriesUID)}));if(!o.length)return;var s=o.length,c=o.map((function(e){return e.id})),l=c.findIndex((function(e){return e===n}));-1===l?l=0:"left"===e?--l<0&&(l=s-1):"right"===e&&++l===s&&(l=0);return c[l]}(e,s,Y,g);if(t){$(t);var n=function(e,t){var n=e.referenceSeriesUID,a=e.SOPInstanceUID,r=t.getActiveDisplaySets().find((function(e){return e.SeriesInstanceUID===n}));return{imageIndex:r.images.findIndex((function(e){return e.SOPInstanceUID===a})),displaySetInstanceUID:r.displaySetInstanceUID}}(s.services.MeasurementService.getMeasurements().find((function(e){return e.id===t})),f),a=n.displaySetInstanceUID,r=n.imageIndex;E.setDisplaysetForViewport({viewportIndex:o,displaySetInstanceUID:a,imageIndex:r})}}}(e)},showNavArrows:Ie,studyData:{label:ve,isTracked:Z,isLocked:!1,studyDate:k(ae),currentSeries:oe,seriesDescription:re,modality:ne,patientInformation:{patientName:le?p.a.utils.formatPN(le.Alphabetic):"",patientSex:ue||"",patientAge:me||"",MRN:ce||"",thickness:de?"".concat(de.toFixed(2),"mm"):"",spacing:fe&&fe.length?"".concat(fe[0].toFixed(2),"mm x ").concat(fe[1].toFixed(2),"mm"):"",scanner:pe||""}}}),r.a.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},r.a.createElement(d.a,{onElementEnabled:function(e){var t=e.detail.element;u.a.store.state.tools.filter((function(e){return e.element===t})).forEach((function(e){if(e instanceof U||e instanceof j||e instanceof P||e instanceof A){var t=e.configuration;t.renderDashed=!Z,e.configuration=t}else if(e instanceof T){var n=e.configuration;n.renderDashed=!0,e.configuration=n}})),c.a.getEnabledElement(t).image&&c.a.updateImage(t),W(t);var n=new CustomEvent("ohif-cornerstone-enabled-element-event",{detail:{enabledElement:t,viewportIndex:o}});document.dispatchEvent(n)},viewportIndex:o,imageIds:X,imageIdIndex:_,onNewImageDebounceTime:700,onNewImageDebounced:function(e){var t=e.currentImageIdIndex;E.setDisplaysetForViewport({viewportIndex:w,displaySetInstanceUID:i.displaySetInstanceUID,imageIndex:t})},resizeRefreshRateMs:150,isActive:!0,isStackPrefetchEnabled:!0,isPlaying:!1,frameRate:24,isOverlayVisible:!0,loadingIndicatorComponent:S,viewportOverlayComponent:function(e){return r.a.createElement(y,D({},e,{activeTools:m.getActiveTools()}))}}),r.a.createElement("div",{className:"absolute w-full"},R.viewportIndex===o&&r.a.createElement(v.z,{message:R.message,type:R.type,actions:R.actions,onSubmit:R.onSubmit,onOutsideClick:R.onOutsideClick})),K))}R.propTypes={displaySet:o.a.object.isRequired,viewportIndex:o.a.number.isRequired,dataSource:o.a.object,children:o.a.node,customProps:o.a.object},R.defaultProps={customProps:{}};var M=["A","B","C","D","E","F","G","H","I"];function F(e,t){var n=e.imageIndex,a=C.findOrCreateStack(e,t),r=Object.assign({},a);return r.currentImageIdIndex=n,r}function q(){return(q=E(regeneratorRuntime.mark((function e(t,n){var a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=F(n,t),r={StudyInstanceUID:n.StudyInstanceUID,displaySetInstanceUID:n.displaySetInstanceUID,stack:a},e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.default=R}}]);
//# sourceMappingURL=4.bundle.12d25f570ff8a08b8d43.js.map